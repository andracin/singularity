{# Admin view template #}
{# harveybc 20171014 #}
{# Includes the master_AdminLTE template containing AdminLTE #}
{% extends '../master_AdminLTE' %}{% block content %}
    <a class="btn btn-success" style="position:relative;top:-5px; padding-top:3px; padding-bottom: 3px;" href="http://dev.ingeni-us.com:3338/db/processes/create"><span class="glyphicon glyphicon-plus"></span> Create New Process</a>
    <div class="box box-info">
        <div id="jsGrid" class="box-header">
        </div>
    </div>
{% endblock %}
{% block footer %}
    <style>
        .header_color{
            color: rgb(0,24,114);
            background-color: rgb(210, 214, 222) !important;
        }
        th{
            padding:0px !important;
        }
        td{
            padding:5px 1px 5px 1px !important;
        }
    </style>
    <script>

        // Gets data from controller
        var data = {{data| dump | safe}};
                $("#jsGrid").jsGrid({
            width: "96%",
            height: "auto",
            inserting: false,
            editing: false,
            sorting: true,
            paging: true,
            data: data,
            rowClick: function (e) {
                window.location = "http://dev.ingeni-us.com:3338/db/processes/detail/" + e.item.id;
            },
            fields: [
                {name: "id", type: "number", width: 30, validate: "required", align: "center", title: "Id", headercss: "header_color"},
                {name: "name", type: "number", width: 100, align: "center", title: "Name", headercss: "header_color"},
                {name: "last_optimum_performance", type: "text", width: 50, align: "center", title: "Last Perf.", headercss: "header_color"},
                {name: "last_block_time", type: "text", width: 50, align: "center", title: "Block Time", headercss: "header_color"},
                {itemTemplate: function (_, item) {
                        return $('<a class="btn btn-primary" style="margin:0; padding:2px 5px 0 5px;" href="http://dev.ingeni-us.com:3338/db/processes/update/' + item.id + '"><span class="glyphicon glyphicon-pencil"></span> </a>');
                    }, width: 40, align: "center", headercss: "header_color"
                },
                {type: "control", editButton: false, width: 40, headercss: "header_color"}
            ],
            editRowRenderer: function (item, itemIndex) {
                window.location = "http://dev.ingeni-us.com:3338/db/processes/update/" + item.id;
            },
            onItemDeleting: function (args) {
                // send a request to the node
                var xmlhttp = new XMLHttpRequest();
                var url = "http://dev.ingeni-us.com:3338/db/processes/" + args.item.id;
                // fired when the state of the request changes
                xmlhttp.onreadystatechange = function () {
                    // readyState==4 ==> request finished and response is ready
                    if (this.readyState == 4 && this.status == 200) {
                        if (this.status == 200) {
                            var response = JSON.parse(this.responseText);
                            // if an item was not deleted, cancel the deletion in the frontend list
                            if (response.result.deleted_count != 1)
                                args.cancel = true;
                        }
                        // if an error code is received, cancel the deletion in the frontend list
                        else
                        {
                            args.cancel = true;
                        }
                    }
                };
                xmlhttp.open("DELETE", url, false);
                xmlhttp.send();
            },
        });





    </script>
{% endblock %}
